!function(t,e){"function"==typeof define&&define.amd?define(function(){return e(t)}):"object"==typeof exports?module.exports=e:t.MiniRouter=e(t)}(this,function(t){"use strict";Function.prototype.bind||(Function.prototype.bind=function(){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=this,e=arguments[0],n=Array.prototype.slice.call(arguments,1);return function(){t.apply(e,n)}});var e=function(t){this.prevRouterHash=null,this.opt=t||{},this.mount=this.opt.mount?document.getElementById(this.opt.mount.replace(/^#/,"")):document.getElementById("app"),this.routers=t.routers||{},this.init()};return e.prototype={init:function(){this.ready(function(){this.router(this.hashHandle()),this.watchRouterChange()}.bind(this))},ready:function(t){"loading"!==document.readyState?t():document.addEventListener?document.addEventListener("DOMContentLoaded",t):document.attachEvent("onreadystatechange",function(){"loading"!==document.readyState&&t()})},queryDeconstruction:function(){var t=window.location.href;if(!/\?|\&/g.test(t))return{};var e=t.split("?")[1].split("&"),n={};for(var o in e){var i=e[o].split("=");n[i[0]]=i[1]}return n},routerHandle:function(t,e){return t&&e?e.path=t:e={path:t},e},router:function(n){this.destroy();var t=this.routerHandle(n,this.routers[n]()),e=this.routerHandle(this.prevRouterHash,this.routers[this.prevRouterHash]&&this.routers[this.prevRouterHash]());this.beforeEach(t,e);var o=this.routers[n];if("function"!=typeof o)return this.mount.innerHTML="",!1;(o=o()).query=this.queryDeconstruction(),o.init&&!o.mount&&(o.mount=o.init),o.beforeEnter&&o.beforeEnter(t,e),o.mount&&o.mount(),o.render&&o.render(function(t,e){this.mount.innerHTML=t,this.routers[n].htmlCache=this.mount.innerHTML,"function"==typeof e?e():o.complete&&o.complete()}.bind(this)),this.prevRouterHash=this.hashHandle()},watchRouterChange:function(){"onhashchange"in window&&("undefined"==typeof document.documentMode||8===document.documentMode)?window.onhashchange=function(){this.router(this.hashHandle())}.bind(this):setInterval(function(){this.isHashChanged()&&this.router(this.hashHandle())}.bind(this),150)},destroy:function(){var t=this.routers[this.prevRouterHash];t&&t().destroy&&t().destroy()},isHashChanged:function(){var t=this.hashHandle();if(t!==this.prevRouterHash)return this.prevRouterHash=t,!0;this.prevRouterHash=t},hashHandle:function(){var t=window.location.hash;return(t=/^#\/[a-z0-9]*/.exec(t))?t[0]:""},beforeEach:function(t){"function"==typeof t&&(this.beforeEach=t)},injection:function(t,e){this.routers[t]=e},next:function(t,e){var n="";for(var o in e){n+="&"+o+"="+e[o]}n=n.replace(/^&/,"?"),window.location.href=t+n}},e});